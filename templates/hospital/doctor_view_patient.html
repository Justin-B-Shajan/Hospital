{% extends 'hospital/doctor_base.html' %}
{% block content %}
{% load static %}

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #0c6ac7;
      font-family: Arial, sans-serif;
    }

    .container {
      padding: 20px;
    }
    h2{
      color:white;
    }

    .page-title {
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
      color: white;
      margin-bottom: 20px;
    }

    .search-form {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 20px;
    }

    .search-form input {
      width: 250px;
      margin-right: 10px;
    }

    .table-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    table thead {
      background-color: #007bff;
      color: white;
    }

    th, td {
      text-align: center;
      vertical-align: middle;
    }

    img.profile-pic {
      border-radius: 50%;
      object-fit: cover;
    }

    .no-data {
      text-align: center;
      color: red;
      font-weight: bold;
      padding: 20px;
    }
  </style>
</head>

<div class="container">
  <h2 class="page-title">Your Patients</h2>

  <!-- Search Bar -->
  <form action="/search" method="get" class="search-form">
    <input class="form-control" type="search" placeholder="Search patients..." name="query" id="query">
    <button class="btn btn-outline-light" type="submit">Search</button>
  </form>

  {% if patients_with_details %}
  <div class="table-container">
    <div class="table-responsive">
      <table class="table table-hover table-striped align-middle">
        <thead>
          <tr>
            <th>Name</th>
            <th>Profile Picture</th>
            <th>Symptoms</th>
            <th>Mobile</th>
            <th>Address</th>
            <th>Prescription</th>
          </tr>
        </thead>
        <tbody>
          {% for item in patients_with_details %}
          <tr>
            <td>{{ item.patient.get_name }}</td>
            <td>
              {% if item.patient.profile_pic %}
                <img src="{% static item.patient.profile_pic.url %}" alt="Profile Pic" height="50" width="50" class="profile-pic">
              {% else %}
                <img src="{% static 'default_profile.png' %}" alt="Profile Pic" height="50" width="50" class="profile-pic">
              {% endif %}
            </td>
            <td>{{ item.symptoms }}</td>
            <td>{{ item.patient.mobile }}</td>
            <td>{{ item.patient.address }}</td>
            <td>
              {% if item.prescriptions %}
                <ul>
                {% for prescription in item.prescriptions %}
                  <li>{{ prescription.medication }}: {{ prescription.dosage }}</li>
                {% endfor %}
                </ul>
                <a href="{% url 'create-prescription' %}?patient_id={{ item.patient.id }}" class="btn btn-sm btn-secondary mt-2">
                  <i class="fas fa-plus"></i> Add More
                </a>
              {% else %}
                <a href="{% url 'create-prescription' %}?patient_id={{ item.patient.id }}" class="btn btn-sm btn-primary">
                  <i class="fas fa-notes-medical"></i> Add Prescription
                </a>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% else %}
    <div class="no-data">No Patients Found!</div>
  {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

{% endblock content %}
